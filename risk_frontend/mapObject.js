
const IP_ADDRESS = "http://10.218.7.206:3000/"

const get_state = () => {
  fetch(IP_ADDRESS+'state')
    .then(resp => resp.json())
      .then(resp => {
        Game.state = resp
        setTimeout(get_state, 444000)
        render_headers()
        board_logic();
      })
}

//render
class mapObject {
  static all_tiles = [{
    id: 91,
    name: "Alaska",
    coordinates: [[46,112], [35,133], [35,158], [61,163], [82,153], [108,163], [118,143], [105,113], [62,103]],
    color: "#333fff",
    neighbours: ["92", "93", "36"]
  },
  {
    id: 92,
    name: "Alberta",
    coordinates:[[108,163], [118,143], [194,153], [194,198], [139,200]],
    color: "#333fff",
    neighbours: ["94", "93", "96"]
  },{
    id: 93,
    name:"North-West Territory",
    coordinates: [[107, 113], [119, 145], [201, 152], [214, 157], [220, 143], [243, 146], [242, 123], [233, 110], [211, 101], [198, 110], [187, 88], [167, 93], [141, 86], [137, 99], [154, 101], [160, 111], [130, 106]],
    color:"#333fff",
    neighbours:["91", "92", "96", "97"]
  },{
    id: 94,
    name:"Western United States",
    coordinates:[[139,200], [142,224], [149,238], [187,241], [192,226],[204,225], [205,200], [194,198]],
    color:"#333fff",
    neighbours:["99", "95", "93"]
  },{
    id: 95,
    name:"Eastern United States",
    coordinates:[[189, 241], [222, 259], [227, 253], [246, 268], [251, 251], [265, 226], [275, 225], [277, 215], [295, 206], [290, 195], [255, 211], [206, 203], [205, 223], [192, 226]],
    color:"#333fff",
    neighbours:["94", "99", "96", "98", "92"]
  },{
    id: 96,
    name:"Ontario",
    coordinates:[[195, 153], [196, 197], [255, 211], [246, 174], [233, 172], [213, 157]],
    color:"#333fff",
    neighbours:["93", "92", "98", "95", "97", "22"]
  },{
    id: 97,
    name:"Greenland",
    coordinates:[[347, 10], [307, 21], [285, 34], [268, 59], [275, 78], [294, 77], [306, 86], [317, 116], [319, 144], [338, 156], [345, 134], [387, 112], [417, 33], [387, 26], [374, 11]],
    color:"#333fff",
    neighbours:["93", "92", "98", "95"]
  },{
    id: 98,
    name:"Quebec",
    coordinates:[[255, 211], [248, 175], [254, 170], [254, 148], [278, 158], [289, 152], [300, 166], [310, 178], [310, 187], [289, 196]],
    neighbours:["96", "95", "97"]
  },{
    id: 99,
    name:"Central America",
    coordinates: [[149,238], [156,253], [177,282], [169,257], [184,283], [218,299], [234,313], [256,315], [244,308], [232,279], [216,284], [211,259], [187,241]],
    color:"#333fff",
    neighbours:["93", "92", "98", "95"]
  },
  //SOUTH AMERICA
  {
    id: 14,
    name:"Venezuela",
    coordinates:[[259, 316], [256, 327], [248, 345], [268, 353], [268, 336], [291, 329], [300, 335], [319, 321], [304, 318], [298, 308], [281, 312], [271, 306]],
    color:"#ff33fd",
    neighbours:["13", "12", "99"]
  },
  {
    id: 12,
    name:"Brazil",
    coordinates:[[316, 323], [300, 338], [290, 327], [268, 333], [266, 352], [271, 359], [266, 366], [277, 378], [297, 387], [305, 412], [313, 418], [300, 433], [307, 443], [323, 427], [332, 410], [353, 397], [357, 371], [363, 355], [347, 344], [327, 335]],
    color:"#ff33fd",
    neighbours:["13","11", "14", "55"]
  },
  {
    id: 13,
    name:"Peru",
    coordinates:[[248, 347], [245, 357], [259, 379], [274, 391], [272, 406], [298, 414], [306, 411], [298, 387], [278, 377], [267, 366], [272, 358], [266, 349]],
    color:"#ff33fd",
    neighbours:["12", "11", "14"]
  },
  {
    id: 11,
    name:"Argentina",
    coordinates:[[271, 407], [261, 489], [275, 505], [288, 500], [276, 490], [286, 474], [281, 471], [305, 444], [298, 434], [314, 418], [308, 411], [299, 415]],
    color:"#ff33fd",
    neighbours:["13", "12"]
  },
  //EUROPE & GREAT BRITAIN
  {
    id: 21,
    name:"Great Britain",
    coordinates:[[426, 187], [427, 186], [428, 186], [430, 186], [434, 186], [437, 185], [438, 184], [439, 184], [440, 184], [442, 182], [441, 181], [439, 181], [437, 181], [436, 181], [436, 179], [436, 179], [436, 178], [436, 177], [436, 174], [435, 170], [435, 169], [435, 168], [434, 166], [433, 167], [431, 167], [430, 168], [430, 166], [432, 165], [433, 164], [433, 160], [431, 156], [431, 156], [430, 156], [430, 156], [428, 152], [428, 151], [431, 147], [432, 145], [432, 142], [428, 143], [422, 144], [425, 139], [420, 138], [417, 142], [417, 144], [414, 146], [412, 150], [410, 153], [410, 156], [410, 158], [413, 160], [416, 161], [416, 164], [416, 168], [414, 170], [411, 170], [406, 172], [407, 175], [412, 175], [413, 176], [412, 178], [409, 180], [410, 181], [412, 182], [417, 182], [412, 184]],
    color:"#A0FF33",
    neighbours:["22", "23", "24","27"]
  },
  {
    id: 22,
    name:"Iceland",
    coordinates: [[385, 130], [386, 142], [405, 146], [417, 135], [409, 123]],
    color:"#A0FF33",
    neighbours:["97", "21","24"]
  },
  {
    id: 23,
    name:"Northen Europe",
    coordinates:[[458, 195], [452, 188], [465, 170], [475, 176], [492, 171], [498, 160], [504, 159], [502, 191], [489, 197], [483, 193]],
    color:"#A0FF33",
    neighbours:["21","24", "25", "26", "27"]
  },
  {
    id: 24,
    name:"Scandinavia",
    coordinates:[[458, 144], [458, 161], [471, 156], [475, 166], [489, 157], [485, 147], [495, 130], [503, 135], [495, 143], [497, 152], [508, 152], [512, 103], [480, 116], [471, 136]],
    color:"#A0FF33",
    neighbours:["21", "22", "23", "24","26"]
  },
  {
    id: 25,
    name:"Southern Europe",
    coordinates:[[459, 198], [459, 212], [466, 212], [476, 224], [471, 228], [483, 234], [487, 223], [478, 207], [482, 207], [497, 222], [508, 220], [519, 208], [503, 190], [488, 197], [483, 192]],
    color:"#A0FF33",
    neighbours:["23","25", "26", "27", "53", "55", "37"]
  },
  {
    id: 26,
    name:"Ukraine",
    coordinates: [[516, 104], [511, 153], [505, 161], [505, 184], [522, 202], [534, 201], [541, 210], [561, 227], [555, 204], [569, 197], [570, 158], [578, 137], [573, 116], [535, 137], [527, 133], [527, 124], [540, 125], [542, 118]],
    color:"#A0FF33",
    neighbours:["23", "24", "25", "26", "37", "31", "311"]
  },
  {
    id: 27,
    name:"Western Europe",
    coordinates:[[450, 190], [433, 196], [440, 210], [421, 212], [420, 230], [431, 234], [440, 231], [440, 224], [447, 224], [449, 213], [456, 213], [457, 199], [450, 190], [432, 197], [439, 211]],
    color:"#A0FF33",
    neighbours:["21","23","25", "55"]
  },
  {
    id: 31,
    name:"Afghanistan",
    coordinates: [[607, 244], [635, 237], [637, 225], [649, 211], [625, 194], [573, 181], [572, 199], [558, 204], [565, 227], [572, 227], [599, 231]],
    color:"#FFB733",
    neighbours:[["32","33", "37", "311", "26"]],
  },
  {
    id: 32,
    name:"China",
    coordinates: [[703, 280], [717, 280], [736, 271], [745, 256], [737, 241], [743, 235], [739, 227], [678, 201], [661, 202], [650, 212], [639, 223], [639, 236], [655, 240], [663, 244], [667, 246], [668, 255], [692, 258]],
    color:"#FFB733",
    neighbours:[["31","33","38","39","310","311"]],
  },
  {
    id: 33,
    name:"India",
    coordinates:[[596, 264], [606, 267], [611, 279], [620, 283], [632, 317], [641, 309], [641, 299], [661, 279], [672, 279], [672, 259], [665, 248], [646, 238], [632, 241], [605, 244], [595, 255]],
    color:"#FFB733",
    neighbours:[["31","32","37","39"]],
  },
  {
    id: 34,
    name:"Irkutsk",
    coordinates:[[687, 119], [684, 176], [743, 185], [769, 134]],
    color:"#FFB733",
    neighbours:[["34", "35", "36","38","310", "312"]],
  },
  {
    id: 35,
    name:"Japan",
    coordinates:[[762, 241], [760, 252], [759, 256], [756, 263], [759, 265], [763, 262], [763, 258], [763, 256], [768, 256], [768, 249], [775, 249], [775, 239], [780, 238], [788, 225], [791, 225], [798, 217], [805, 217], [805, 212], [816, 210], [812, 208], [809, 205], [806, 203], [800, 203], [796, 205], [796, 207], [792, 215], [788, 215], [787, 219], [787, 223], [787, 223], [783, 223], [778, 233], [771, 233]],
    color:"#FFB733",
    neighbours:[["36","38"]],
  },
  {
    id: 36,
    name:"Kamchatka",
    coordinates: [[765, 213], [784, 197], [791, 177], [777, 170], [793, 155], [817, 155], [827, 145], [845, 144], [823, 167], [824, 186], [841, 170], [844, 155], [874, 143], [884, 131], [884, 114], [854, 112], [813, 103], [769, 136], [746, 185]],
    color:"#FFB733",
    neighbours:[["91","34","35","38","312"]],
  },
  {
    id: 37,
    name:"Middle East",
    coordinates: [[562, 229], [536, 209], [509, 219], [509, 228], [532, 236], [526, 248], [521, 252], [526, 262], [536, 264], [549, 288], [549, 301], [575, 294], [591, 277], [582, 266], [572, 270], [562, 257], [568, 252], [579, 259], [596, 266], [596, 256], [605, 243], [599, 235], [575, 227]],
    color:"#FFB733",
    neighbours:[["31","33", "53", "52", "26", "25"]],
  },
  {
    id: 38,
    name:"Mongolia",
    coordinates: [[752, 243], [764, 235], [757, 224], [765, 214], [746, 185], [683, 174], [680, 197], [736, 224], [741, 228], [748, 227]],
    color:"#FFB733",
    neighbours:[["32","34", "35", "36", "37","310"]],
  },
  {
    id: 39,
    name:"Siam",
    coordinates: [[672, 259], [666, 279], [676, 287], [674, 298], [682, 297], [682, 314], [699, 333], [699, 324], [691, 310], [692, 303], [700, 311], [711, 307], [711, 296], [703, 286], [703, 279], [692, 259]],
    color:"#FFB733",
    neighbours:[["32","33", "42"]],
  },
  {
    id: 310,
    name:"Siberia",
    coordinates: [[616, 91], [614, 115], [627, 152], [662, 199], [677, 199], [684, 177], [686, 116], [687, 74], [663, 78], [646, 94], [623, 100]],
    color:"#FFB733",
    neighbours:[["34","38", "311", "312"]],
  },
  {
    id: 311,
    name:"Ural",
    coordinates: [[602, 70], [579, 78], [569, 100], [579, 112], [581, 144], [572, 157], [572, 179], [627, 193], [650, 208], [660, 200], [628, 154], [613, 119], [588, 112], [581, 101], [592, 90]],
    color:"#FFB733",
    neighbours:[["31","32","35", "310"]],
  },
  {
    id: 312,
    name:"Yakutsk",
    coordinates:[[698, 62], [689, 75], [687, 115], [770, 133], [815, 107], [814, 98], [781, 96], [765, 105], [764, 91], [748, 89], [744, 95], [718, 90], [724, 72]],
    color:"#FFB733",
    neighbours:[["34", "36", "39", "310"]],
  },
  {
    id: 41,
    name:"Eastern Australia",
    coordinates:[[778, 384], [772, 407], [766, 410], [772, 428], [776, 436], [779, 439], [784, 438], [788, 445], [792, 448], [804, 449], [810, 438], [819, 425], [816, 407], [809, 402], [804, 395], [800, 388], [797, 381], [790, 368], [785, 386]],
    color:"#B733FF",
    neighbours:[["43","44"]],
  },
  {
    id: 42,
    name:"Indonesia",
    coordinates:[[678, 322], [673, 326], [688, 352], [698, 352], [699, 362], [747, 370], [751, 364], [730, 358], [731, 355], [746, 354], [740, 343], [748, 343], [748, 336], [736, 336], [732, 348], [730, 359], [711, 355], [714, 348], [724, 347], [736, 326], [731, 317], [709, 330], [709, 345], [697, 341]],
    color:"#B733FF",
    neighbours:[["43","44", "39"]],
  },
  {
    id: 43,
    name:"New Guinea",
    coordinates:[[774, 348], [780, 358], [774, 359], [792, 365], [796, 363], [802, 370], [819, 364], [811, 354], [803, 348], [791, 345], [779, 341]],
    color:"#B733FF",
    neighbours:[["41", "42","44"]],
  },
  {
    id: 44,
    name:"Western Australia",
    coordinates:[[749, 374], [739, 392], [723, 397], [723, 412], [726, 421], [725, 438], [734, 438], [739, 429], [747, 432], [755, 430], [761, 430], [768, 430], [771, 430], [765, 412], [771, 406], [776, 383], [776, 373], [760, 369], [757, 376]],
    color:"#B733FF",
    neighbours:[["41", "42", "43"]],
  },
  {
    id: 51,
    name:"Congo",
    coordinates:[[461, 344], [476, 364], [489, 362], [494, 373], [501, 373], [508, 364], [512, 328], [486, 327], [479, 340]],
    color:"#1D3C70",
    neighbours:[["52", "55", "56"]],
  },
  {
    id: 52,
    name:"East Africa",
    coordinates: [[542, 381], [526, 376], [522, 382], [515, 380], [515, 365], [509, 365], [515, 330], [502, 324], [499, 297], [512, 280], [529, 274], [538, 292], [549, 305], [572, 304], [568, 324], [552, 335], [547, 342], [545, 353], [545, 365], [545, 375]],
    color:"#1D3C70",
    neighbours:[["51", "37", "53", "54","55", "56"]],
  },
  {
    id: 53,
    name:"Egypt",
    coordinates: [[497, 246], [491, 251], [476, 266], [470, 281], [497, 299], [512, 280], [530, 275], [529, 263], [521, 255], [509, 248]],
    color:"#1D3C70",
    neighbours:[["52","25","55","37"]],
  },
  {
    id: 54,
    name:"Madagascar",
    coordinates: [[553, 381], [565, 371], [570, 382], [568, 388], [566, 393], [560, 394], [564, 403], [557, 407], [557, 414], [551, 415], [545, 412], [552, 405], [549, 403], [549, 396], [553, 393], [549, 389], [549, 385], [553, 385]],
    color:"#1D3C70",
    neighbours:[["52","56"]],
  },
  {
    id: 55,
    name:"North Africa",
    coordinates: [[469, 233], [435, 239], [408, 277], [408, 306], [410, 316], [423, 325], [434, 326], [448, 324], [464, 325], [465, 331], [464, 341], [477, 340], [485, 326], [501, 327], [497, 298], [471, 280], [475, 267], [486, 252], [471, 242], [469, 236]],
    color:"#1D3C70",
    neighbours:[["51", "52", "53", "25","12","27"]],
  },
  {
    id: 56,
    name:"South Africa",
    coordinates:[[475, 364], [470, 389], [489, 436], [506, 436], [517, 431], [533, 408], [533, 395], [542, 384], [526, 376], [521, 384], [513, 381], [513, 369], [506, 365], [504, 374], [494, 374], [488, 363]],
    color:"#1D3C70",
    neighbours:[["51", "52","54"]],
  },]

  static drawterritory = tile => {
    const ctx = canvas.getContext('2d')
    ctx.beginPath();
    for(let i = 0; i < tile.coordinates.length; i++){
      if(i==0){
        ctx.moveTo(tile.coordinates[0][0],tile.coordinates[0][1])
      }else{
        ctx.lineTo(tile.coordinates[i][0], tile.coordinates[i][1])
        ctx.fillStyle = tile.color;
      };
    };
    ctx.closePath();
    ctx.fill();
    ctx.stroke()
    ctx.lineWidth = 2;
    // ctx.strokeStyle = Game..color;
  }

  static draw_cases = tile =>{
    const append_here = document.querySelector("map")
    const area = document.createElement("area")
    area.shape = "poly"
    area.alt = "obj.name"
    const coords = tile.coordinates.flat()
    coords.toString
    area.coords = coords+`,${tile.coordinates[0][0]},${tile.coordinates[0][1]}`
    area.onclick = () => {
      board_logic(tile.id)
    }
    append_here.append(area)
  }
  static render = () =>{
    this.all_tiles.map(tile => {
      this.drawterritory(tile);
      this.draw_cases(tile);
    })
  }
  static select = id => this.all_tiles.find(tile =>tile.id == id)
}

const render_headers = () =>{
  const turn = document.querySelector("#turn")
  const phase = document.querySelector("#phase")
  const current_player = document.querySelector("#currentPlayer")
  turn.innerText = `Turn: ${Game.state.turn}`
  phase.innerText = `${Game.state.currentPhase}`
  currentPlayer.innerText = `${Game.state.currentPlayer.name}'s turn`
}


mapObject.render()
get_state()

// <b>Universal</b>
// * GET - GAME STATE
//   - route 'Game.state'
//   - returns Game.STATE
//
// * POST - END TURN
//   - route 'endturn'
//   - body: {user_id: //int// }
//   - returns Game.STATE
//
// <b>Game Setup Phase</b>
// * POST - CONNECT SERVER
//   - route 'connect'
//   - body: {user: {name: //string//, colour: //string// }}
//   - returns Game.STATE[:users]
//
// * POST - START GAME
//   - route 'start_game'
//   - body: {user_id: //int//, ready: //boolean//}
//   - return Game.LIVE + Setup.READY
//
// * POST - DEPLOY ARMIES
//   - route 'deploy_armies'
//   - body: {user_id: //int//, territory_id: //id//, armies: //int//}
//       - note; armies count must be 2 or less for Deploy Phase in the GAME Setup
//   - return Game.STATE + Setup.STATE
